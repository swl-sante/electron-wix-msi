<InstallUISequence>
  <Show Dialog="WelcomeDlg" Before="ProgressDlg" Overridable="no">0</Show>
  <Show Dialog="OptionsDlg" Overridable="yes" Before="ExecuteAction">1</Show>
  <!--<Show Dialog="PathOptionDlg" After="OptionsDlg" Overridable="no">1</Show>-->
</InstallUISequence>

<Property Id="MSIUSEREALADMINDETECTION" Value="1" />

<Condition Message="Installation requires Administrator privileges">
  <![CDATA[Privileged]]>
</Condition>

<SetProperty Sequence="first" Before="CostInitialize" Id="APPLICATIONROOTDIRECTORY" Value="[LocalAppDataFolder]Programs\monsisraap">
  <![CDATA[ALLUSERS<>1]]>
</SetProperty>



<Property Id="PrefPath"></Property>

<?ifdef env.REPERTOIREMONSISRA ?>

<SetProperty Sequence="first" Before="CostInitialize" Action="SetPrefPathEnv" Id="PrefPath" Value="$(env.REPERTOIREMONSISRA)"/>

<?else?>

<SetProperty Sequence="first" Before="CostInitialize" Action="SetPrefPathMachine" Id="PrefPath" Value="$(env.USERPROFILE)\AppData\Local\MonSisra2">
  <![CDATA[ALLUSERS=1]]>
</SetProperty>

<SetProperty Sequence="first" Before="CostInitialize" Action="SetPrefPathUser" Id="PrefPath" Value="[LocalAppDataFolder]Programs\monsisraap">
  <![CDATA[ALLUSERS<>1]]>
</SetProperty>

<?endif ?>





<CustomAction Id="SetDefaultPathFromCheckbox" Script="vbscript">
  <![CDATA[         
        value = Session.Property("ALLUSERS")
        localAppData = Session.Property("LocalAppDataFolder")
        programfiles =  Session.Property("ProgramFilesFolder")
   
        If value="1" Then
          Session.Property("APPLICATIONROOTDIRECTORY") = programfiles & "{{ApplicationBinary}}"
        Else
          Session.Property("APPLICATIONROOTDIRECTORY") = localAppData & "Programs\monsisraap"
        End If

      ]]>
</CustomAction>



<CustomAction Id="ChangePrefEnvVar" Script="jscript">
  <![CDATA[         
        var shell = new ActiveXObject("WScript.shell");
        shell.Environment("SYSTEM")("REPERTOIREMONSISRA") = Session.Property("PrefPath")
      ]]>
</CustomAction>
